<!DOCTYPE html>
<html>
<head>
  <title>WebAR Markerless Ghost Monk Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-extras@7.0.0/dist/aframe-extras.min.js"></script>
  <script>
    AFRAME.registerComponent('custom-animation', {
      init: function () {
        this.el.addEventListener('model-loaded', () => {
          const model = this.el.getObject3D('mesh');
          if (model.animations && model.animations.length > 0) {
            this.mixer = new THREE.AnimationMixer(model);
            this.mixer.clipAction(model.animations[0]).play();
          }
        });
      },
      tick: function (time, delta) {
        if (this.mixer) {
          this.mixer.update(delta / 1000);
        }
      }
    });
    AFRAME.registerComponent('custom-material', {
      init: function () {
        this.el.addEventListener('model-loaded', () => {
          const model = this.el.getObject3D('mesh');
          model.traverse((node) => {
            if (node.isMesh) {
              node.material.opacity = 0.2;
              node.material.transparent = true;
              node.material.needsUpdate = true;
            }
          });
        });
      }
    });
    AFRAME.registerComponent('auto-place', {
      init: function () {
        this.el.setAttribute('ar-hit-test', 'enabled: true');
        this.el.setAttribute('visible', true);
      }
    });
  </script>
</head>
<body>
  <a-scene
    webxr="requiredFeatures: hit-test,local-floor;"
    renderer="antialias: true;"
    embedded>
    <a-assets>
      <a-asset-item id="ghost-glb" src="https://raw.githubusercontent.com/HoneyAffect/arjs-models/main/ghost.glb"></a-asset-item>
    </a-assets>
    <a-entity
      id="ghost-model"
      gltf-model="#ghost-glb"
      scale="2 2 2"
      position="0 0 0"
      custom-animation
      custom-material
      auto-place>
    </a-entity>
    <a-camera position="0 1.6 0"></a-camera>
  </a-scene>
</body>
</html>